# Expo env vars for Convex (dev vs EAS builds)

## What `npx convex dev` does for Expo
- Creates a Convex project and writes your deployment URL to `.env.local` as `EXPO_PUBLIC_CONVEX_URL`.
- Creates the `convex/` backend folder and continuously syncs it while the command runs.

## Expo env var rules you must follow
- **Use the `EXPO_PUBLIC_` prefix** for any variable you read from client code.
- Read it as `process.env.EXPO_PUBLIC_CONVEX_URL` inside the app.

## Local development (Expo CLI / Metro)
1. Run `npx convex dev` once (and keep it running while coding).
2. Confirm `.env.local` exists and contains:

   ```bash
   EXPO_PUBLIC_CONVEX_URL=https://<your-deployment>.convex.cloud
   ```

3. Restart Metro when you change env files:
   - stop the dev server and start it again (clearing cache if needed).

## EAS builds (Preview/Production)
Expo’s guide recommends copying the URL from `.env.local` into EAS environment variables so it is available during cloud builds:

```bash
eas env:create --name EXPO_PUBLIC_CONVEX_URL --value https://YOUR_DEPLOYMENT_URL.convex.cloud \
  --visibility plaintext \
  --environment production --environment preview --environment development
```

### Recommended policy
- **development:** use the dev deployment URL generated by `npx convex dev`
- **preview:** use a separate Convex preview deployment
- **production:** use the production deployment

If you later rotate URLs, update EAS env vars and rebuild.

## Common failure modes
### `process.env.EXPO_PUBLIC_CONVEX_URL` is `undefined`
- `.env.local` not present (you haven’t run `npx convex dev`, or it wrote to a different env file)
- Metro not restarted after adding env vars
- you used `CONVEX_URL` (missing `EXPO_PUBLIC_` prefix) instead of `EXPO_PUBLIC_CONVEX_URL`

### EAS build works locally but fails in CI
- you only set `.env.local` and forgot EAS env vars (EAS cloud builds do not read your local `.env.local`)

